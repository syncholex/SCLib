syntax = "proto3";
package snapchat.research;
option optimize_for = CODE_SIZE;
option objc_class_prefix = "SAS";
option csharp_namespace = "SnapProto.Snapchat.Research";

import "snapchat/research/SnapBrain.proto";

message SASAudioFingerprintMessage {
    string submissionId = 1;
    string geoHash = 2;
    int64 userTimestamp = 3;
    int64 messageTimestamp = 4;
    double longitude = 5;
    double latitude = 6;
    .snapchat.research.SnapBrainResponse.SnapBrainResponse_Results.SnapBrainResponse_Results_AudioFingerprint audioFingerprint = 7;
    string signedURL = 8;
    string captionText = 9;
    int32 mediaType = 10;
    int64 captureTimestamp = 11;
    string userId = 12;
    repeated string sharedStoryIdsArray = 13;
    int32 orientation = 14;
    bool isFrontFacing = 15;
    double timeLength = 16;
}

message SASAudioStitch {
    string id_p = 1;
    double length = 2;
    repeated .snapchat.research.SASAudioStitchPoint audioStitchPointsArray = 3;
    int32 totalPointsCount = 4;
    int32 snapsPerRow = 5;
    int32 snapsPerColumn = 6;
    .snapchat.research.SASAudioStitch.SASAudioStitch_Source source = 7;
    enum SASAudioStitch_Source {
        SASAudioStitch_Source_Unknown = 0;
        SASAudioStitch_Source_Spock = 1;
        SASAudioStitch_Source_AutoGenerated = 2;
    }
}

message SASAudioStitchIngest {
    string sharedStorySubmissionId = 1;
    .snapchat.research.SASAudioFingerprintMessage audioFingerprintMessage = 100;
    .snapchat.research.SASSnapDeletionMessage snapDeletionMessage = 101;
}

message SASAudioStitchMediaRequest {
    .snapchat.research.SASAudioStitch audioStitch = 1;
    string entityKind = 2;
    repeated .snapchat.research.SASAudioStitchMediaRequest.SignedUrlsEntry signedUrls = 3;
    message SignedUrlsEntry {
        string key = 1;
        string value = 2;
    }
}

message SASAudioStitchMediaResponse {
    .snapchat.research.SASAudioStitch audioStitch = 1;
    string entityKind = 2;
    bool success = 3;
    .snapchat.research.SASMediaInfo mediaInfo = 4;
}

message SASAudioStitchPoint {
    string submissionId = 1;
    double startTime = 2;
    double endTime = 3;
    int32 positionIndex = 4;
}

message SASComputeAudioStitchesRequest {
    repeated string snapIdsArray = 1;
    int32 matchThreshold = 2;
    int64 maxTimestampDiff = 3;
}

message SASComputeAudioStitchesResponse {
    repeated .snapchat.research.SASAudioStitch audioStitchesArray = 1;
}

message SASDataflowMessage {
    repeated .snapchat.research.SASDataflowMessage.SASDataflowMessage_AudioStitchAction audioStitchActionsArray = 1;
    message SASDataflowMessage_AudioStitchAction {
        .snapchat.research.SASAudioStitch audioStitch = 1;
        .snapchat.research.SASDataflowMessage.SASDataflowMessage_AudioStitchAction.SASAction action = 2;
        enum SASAction {
            SASAction_Put = 0;
            SASAction_Delete = 1;
        }
    }
}

message SASGetTrackStitchRequest {
    string trackId = 1;
    int64 createdTimestamp = 2;
}

message SASGetTrackStitchResponse {
    .snapchat.research.SASAudioStitch audioStitch = 1;
}

message SASMatchSnapRequest {
    .snapchat.research.SASAudioFingerprintMessage audioFingerprintMessage = 1;
}

message SASMatchSnapResponse {
    .snapchat.research.SASTrackMatch trackMatch = 1;
}

message SASMediaInfo {
    string bucket = 1;
    string mediaPath = 2;
    string thumbnailPath = 3;
    int64 mediaSize = 4;
}

message SASSnapDeletionMessage {
    int64 userTimestamp = 1;
    int64 messageTimestamp = 2;
    int64 captureTimestamp = 3;
}

message SASTrack {
    string trackId = 1;
    .snapchat.research.SnapBrainResponse.SnapBrainResponse_Results.SnapBrainResponse_Results_AudioFingerprint audioFingerprint = 2;
}

message SASTrackMatch {
    string submissionId = 1;
    string trackId = 2;
    double matchTime = 3;
    int32 matchScore = 4;
    double matchLength = 5;
}

message SASUploadTrackRequest {
    bytes mediaString = 1;
    string trackId = 2;
}

message SASUploadTrackResponse {
}